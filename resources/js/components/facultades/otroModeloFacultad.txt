<template>
<v-app>
    <v-container>       
        <v-row             
            align="center" 
            justify="center" 
            v-if="loading"
        >
            <v-col
                cols="12"
                md="4"      
                align="center"
                justify="center"            
                class="fill-height"
            >                
                <v-progress-circular
                    :size="60"
                    color="primary"
                    indeterminate
                ></v-progress-circular><br>
                <Strong>Cargando...</Strong>
            </v-col>              
        </v-row>          
        <v-row            
            class="fill-height" 
            v-else
        >
            <v-menu
                v-model="showMenu"
                absolute
                offset-y                        
            >
            <template v-slot:activator="{ on, attrs }" >               
                <template v-for="(facultad, i) in facultades">
                    <v-col
                    :key="i"
                    cols="12"
                    md="4"
                    >                    
                        <v-hover v-slot="{ hover }">                            
                            <v-card
                                :elevation="hover ? 12 : 2"
                                :class="{ 'on-hover': hover }"
                                v-bind="attrs"
                                v-on="on"
                                @click="loadCarrera(facultad.id)"
                            >
                                <v-img
                                    :src="'img/facultades/'+facultad.foto"
                                    height="225px"
                                >
                                    <v-card-title class="text-h6 white--text">
                                    <v-row
                                        class="fill-height flex-column"
                                        
                                    >                    
                                        <div>
                                        <p class="ma-0 text-body-1 font-weight-bold font-italic text-left">
                                            {{ facultad.nombre_facultad }}
                                        </p>
                                        <p class="text-caption font-weight-medium font-italic text-left">
                                            {{ facultad.descripcion_facultad }}
                                        </p>
                                        </div>                    
                                    </v-row>
                                    </v-card-title>
                                </v-img>
                            </v-card>                            
                        </v-hover>
                    </v-col>
                </template>                
            </template>            
            <v-list v-if="existen_carreras">
                <v-list-item
                    v-for="(carrera, i) in carreras"
                    :key="i"
                >                    
                    <v-list-item-title>
                        <router-link :to="`/carreras?facultad=${carrera.id}`">
                            {{ carrera.nombre_carrera }}
                        </router-link>
                    </v-list-item-title>                    
                </v-list-item>
            </v-list>
            </v-menu>
        </v-row>                          
    </v-container>
</v-app>
</template>
<script>
export default {
   data: () => ({
      facultades: [],
      carreras: [],
      loading: true,
      showMenu: false,
      existen_carreras: false,
      form: new Form({    
        id: '',   
        nombre_facultad: '',                            
        descripcion_facultad: '',                    
        foto: '',       
      }),                  
      transparent: 'rgba(255, 255, 255, 0)',      
    }),
    methods: {
        async loadFacultad(){                                           
            await axios.get("api/facultades")
                .then(response =>{                                        
                    this.facultades = response.data;
                    this.loading = false;
                })
                .catch(error=>{
                    this.facultades = []
                });            
        },   
        async loadCarrera(id){                 
            await axios.get('api/facultades/'+id)
                .then(response =>{   
                    this.form.id = id;             
                    this.existen_carreras = true,
                    this.carreras = response.data;                                    
                })
                .catch(error=>{
                    this.carreras = []      
                    this.existen_carreras = false;
                    Swal.fire("Ups!", "No hay Carreras en la Facultad.", "warning");                               
                });            
        },  
    },
    created() {
        this.loadFacultad();        
        Fire.$on('AfterCreate',() => {
            this.loadFacultad();
        }); 
    }
}
</script>

<style scoped>
.v-card {
  transition: opacity .4s ease-in-out;
}

.v-card:not(.on-hover) {
  opacity: 0.6;
 }

.show-btns {
  color: rgba(255, 255, 255, 1) !important;
}
</style>